{% extends "base_pdf.html" %}
{% import "_pdf_macros.html" as pm %}

{% block head_extra %}
  <style>
    /* Ensure plain white background for printable basic template */
    body { background: #ffffff !important; }
    .page { background: #ffffff !important; }
    /* Force plain text look */
    body, .page { color: #000000 !important; }
    h1, h2, h3, p, li, div, span { color: #000000 !important; }
    .divider { border-top: 1px solid #000; margin: 16px 0; }
    .section { margin-top: 14px; }
    .kv { margin: 4px 0; }
    .label { font-weight: 700; }
    .item { margin: 6px 0; }
    .small { font-size: 10pt; }
  </style>
{% endblock %}

{% block body %}
  <div class="page">
    <h1 class="title">{{ ctx.property_name or 'Guidebook' }}</h1>
    {# Optional QR (plain, small) #}
    {% if ctx.qr_img_src %}
    <div style="position:absolute; top:2.2cm; right:2.2cm; border:1px solid #000; padding:6px; width:3.5cm; text-align:center; background:#fff;">
      <img src="{{ ctx.qr_img_src }}" alt="QR" style="width:100%; height:auto; display:block;"/>
      <div style="font-size:10px; margin-top:4px;">Scan for live guidebook</div>
    </div>
    {% endif %}

    {# Welcome message #}
    {% if ctx.welcome_message %}
    <div class="section">
      <h2>Welcome</h2>
      <div style="white-space: pre-line;">{{ ctx.welcome_message }}</div>
    </div>
    <div class="divider"></div>
    {% endif %}

    <div>
      <h2>Address & Times</h2>
      <div class="grid-2">
        <div>
          {% if ctx.address.street or ctx.address.city_state or ctx.address.zip %}
          <p class="kv"><span class="label">Address:</span>
            {% if ctx.address.street %}{{ ctx.address.street }}{% endif %}
            {% if ctx.address.city_state %}{% if ctx.address.street %}, {% endif %}{{ ctx.address.city_state }}{% endif %}
            {% if ctx.address.zip %}{% if ctx.address.street or ctx.address.city_state %}, {% endif %}{{ ctx.address.zip }}{% endif %}
          </p>
          {% endif %}
          {% if ctx.access_info %}
          <p class="kv"><span class="label">Access Info:</span> {{ ctx.access_info }}</p>
          {% endif %}
          {% if ctx.parking_info %}
          <p class="kv"><span class="label">Parking Info:</span> {{ ctx.parking_info }}</p>
          {% endif %}
        </div>
        <div>
          {% if ctx.check_in_time %}
          <p class="kv"><span class="label">Check-in:</span> {{ ctx.check_in_time }}</p>
          {% endif %}
          {% if ctx.check_out_time %}
          <p class="kv"><span class="label">Check-out:</span> {{ ctx.check_out_time }}</p>
          {% endif %}
        </div>
      </div>
    </div>

    <div class="divider"></div>

    {% if ctx.wifi.network or ctx.wifi.password %}
    <div class="section">
      <h2>Wiâ€‘Fi</h2>
      {% if ctx.wifi.network %}<p class="kv"><span class="label">Network:</span> {{ ctx.wifi.network }}</p>{% endif %}
      {% if ctx.wifi.password %}<p class="kv"><span class="label">Password:</span> {{ ctx.wifi.password }}</p>{% endif %}
    </div>
    <div class="divider"></div>
    {% endif %}

    {# Safety Info #}
    {% set has_safety = ctx.safety_info and (ctx.safety_info.get('emergency_contact') or ctx.safety_info.get('fire_extinguisher_location')) %}
    {% if has_safety %}
    <div class="section">
      <h2>Safety Info</h2>
      {% if ctx.safety_info.get('emergency_contact') %}
      <p class="kv"><span class="label">Emergency Contact:</span> {{ ctx.safety_info.get('emergency_contact') }}</p>
      {% endif %}
      {% if ctx.safety_info.get('fire_extinguisher_location') %}
      <p class="kv"><span class="label">Fire Extinguisher Location:</span> {{ ctx.safety_info.get('fire_extinguisher_location') }}</p>
      {% endif %}
    </div>
    <div class="divider"></div>
    {% endif %}

    {% if ctx.rules and ctx.rules|length > 0 %}
    <div class="section">
      <h2>House Rules</h2>
      <ul>
        {% for r in ctx.rules %}
          {% if r %}<li>{{ r }}</li>{% endif %}
        {% endfor %}
      </ul>
    </div>
    <div class="divider"></div>
    {% endif %}

    {% if ctx.house_manual and ctx.house_manual|length > 0 %}
    <div class="section">
      <h2>House Manual</h2>
      {% for item in ctx.house_manual %}
        <div style="margin: 6px 0;">
          {% if item.name %}<div style="font-weight:600;">{{ item.name }}</div>{% endif %}
          {% if item.description %}<div style="white-space: pre-line;">{{ item.description }}</div>{% endif %}
        </div>
      {% endfor %}
    </div>
    <div class="divider"></div>
    {% endif %}

    {% if ctx.places_to_eat and ctx.places_to_eat|length > 0 %}
    <div class="section">
      <h2>Places to Eat</h2>
      {% for it in ctx.places_to_eat %}
        <div class="item">
          {% if it.name %}<div style="font-weight:700;">{{ it.name }}</div>{% endif %}
          {% if it.description %}<div class="small">{{ it.description }}</div>{% endif %}
          {% if it.address %}<div class="small">{{ it.address }}</div>{% endif %}
        </div>
      {% endfor %}
    </div>
    <div class="divider"></div>
    {% endif %}

    {% if ctx.things_to_do and ctx.things_to_do|length > 0 %}
    <div class="section">
      <h2>Things to Do</h2>
      {% for it in ctx.things_to_do %}
        <div class="item">
          {% if it.name %}<div style="font-weight:700;">{{ it.name }}</div>{% endif %}
          {% if it.description %}<div class="small">{{ it.description }}</div>{% endif %}
          {% if it.address %}<div class="small">{{ it.address }}</div>{% endif %}
        </div>
      {% endfor %}
    </div>
    <div class="divider"></div>
    {% endif %}

    {% if ctx.host.name or ctx.host.contact %}
    <div class="section">
      <h2>Host</h2>
      {% if ctx.host.name %}<p class="kv"><span class="label">Name:</span> {{ ctx.host.name }}</p>{% endif %}
      {% if ctx.host.contact %}<p class="kv"><span class="label">Contact:</span> {{ ctx.host.contact }}</p>{% endif %}
    </div>
    <div class="divider"></div>
    {% endif %}

    {% if ctx.checkout_info and ctx.checkout_info|length > 0 %}
    <div class="section">
      <h2>Checkout</h2>
      <ul>
        {% for item in ctx.checkout_info %}
          {% if item is string %}
            <li>{{ item }}</li>
          {% elif item.text %}
            <li>{{ item.text }}</li>
          {% elif item.name or item.description %}
            <li>
              {% if item.name %}<span class="label">{{ item.name }}:</span>{% endif %}
              {% if item.description %} <span>{{ item.description }}</span>{% endif %}
            </li>
          {% else %}
            <li>{{ item|string }}</li>
          {% endif %}
        {% endfor %}
      </ul>
    </div>
    <div class="divider"></div>
    {% endif %}

    {# Custom Tabs: iterate included_tabs for custom_* and render from custom_sections/meta #}
    {% for tab in ctx.included_tabs %}
      {% if tab.startswith('custom_') %}
        {% set blocks = ctx.custom_sections.get(tab) %}
        {% set meta = ctx.custom_tabs_meta.get(tab) %}
        {% set label = (meta and meta.get('label')) or 'Custom Section' %}
        {% if blocks and blocks|length > 0 %}
        <div class="section">
          <h2>{{ label }}</h2>
          {% for b in blocks %}
            {% if b is string %}
              <div class="item">{{ b }}</div>
            {% else %}
              <div class="item">
                {% if b.name %}<div style="font-weight:600;">{{ b.name }}</div>{% endif %}
                {% if b.description %}<div style="white-space: pre-line;">{{ b.description }}</div>{% endif %}
                {% if b.text %}<div style="white-space: pre-line;">{{ b.text }}</div>{% endif %}
              </div>
            {% endif %}
          {% endfor %}
        </div>
        <div class="divider"></div>
        {% endif %}
      {% endif %}
    {% endfor %}

    {# Deliberately minimal: no footer caption #}
  </div>
{% endblock %}
