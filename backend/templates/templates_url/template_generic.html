<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Guidebook: {{ ctx.property_name }}</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-color: oklch(0.6923 0.22 21.05);
      --background-color: #f8fafc;
      --card-background: #ffffff;
      --text-color: #1e293b;
      --light-text-color: #64748b;
      --border-color: #e2e8f0;
    }
    body { font-family: 'Poppins', sans-serif; margin: 0; background-color: var(--background-color); color: var(--text-color); }
    .header { background: url('{{ ctx.cover_image_url }}') no-repeat center center; background-size: cover; color: white; padding: 4rem 1rem; text-align: center; position: relative; }
    .header::before { content: ''; position: absolute; inset: 0; background: rgba(0,0,0,0.5); }
    .header-content { position: relative; z-index: 1; }
    .header h1 { margin: 0; font-size: 2.5rem; }
    .tabs-container { position: relative; background-color: var(--card-background); border-bottom: 1px solid var(--border-color); }
    .tabs { display: flex; overflow-x: auto; -ms-overflow-style: none; scrollbar-width: none; }
    .tabs::-webkit-scrollbar { display: none; }
    .tab-button { padding: 1rem; border: none; background: none; cursor: pointer; font-size: 1rem; font-weight: 600; color: var(--light-text-color); white-space: nowrap; display: flex; align-items: center; gap: 0.5rem; transition: color 0.3s ease; position: relative; z-index: 1; }
    .tab-button:not(.active):hover { background-color: #f1f5f9; border-radius: 8px; }
    .tab-button.active { color: white; }
    .tab-slider { position: absolute; top: 50%; transform: translateY(-50%); height: calc(100% - 0.75rem); background-color: var(--primary-color); border-radius: 8px; transition: left 0.3s ease-out, width 0.3s ease-out; z-index: 0; }
    .tab-content { display: none; padding: 1.5rem; }
    .tab-content.active { display: block; }
    .card { background: var(--card-background); border-radius: 8px; padding: 1.5rem; margin-bottom: 1.5rem; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
    .card h2 { margin-top: 0; font-size: 1.5rem; color: var(--primary-color); border-bottom: 1px solid var(--border-color); padding-bottom: 0.5rem; margin-bottom: 1rem; }
    .info-grid { display: grid; grid-template-columns: 1fr; gap: 1.5rem; }
    .info-item strong { display: block; color: var(--text-color); margin-bottom: 0.25rem; }
    .rules-list { list-style: none; padding: 0; }
    .rules-list li { margin-bottom: 0.75rem; padding-left: 1.5rem; position: relative; }
    .rules-list li::before { content: '✓'; color: var(--primary-color); position: absolute; left: 0; }
    .recommendation-grid { display: grid; grid-template-columns: 1fr; gap: 1.5rem; }
    .recommendation-card { background: var(--card-background); border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.07); overflow: hidden; display: flex; flex-direction: column; }
    .recommendation-card img { width: 100%; aspect-ratio: 16 / 10; object-fit: cover; }
    .recommendation-card-content { padding: 1rem 1.25rem; }
    .recommendation-card-content h3 { margin: 0 0 0.5rem; font-size: 1.25rem; }
    .recommendation-card-content p { margin: 0; color: var(--light-text-color); }
    @media (min-width: 640px) { .recommendation-grid { grid-template-columns: repeat(2, 1fr); } }
    @media (min-width: 1024px) { .recommendation-grid { grid-template-columns: repeat(3, 1fr); } }
    @media (min-width: 768px) { .info-grid { grid-template-columns: 1fr 1fr; } .tabs { justify-content: center; } }
  </style>
</head>
<body>
  <div class="header">
    <div class="header-content">
      <h1>{{ ctx.property_name }}</h1>
      <p>Your personal guidebook</p>
    </div>
  </div>

  <div class="tabs-container">
    {% set first_tab = ctx.included_tabs[0] if ctx.included_tabs and ctx.included_tabs|length > 0 else 'checkin' %}
    <div class="tabs">
      {% for tab in ctx.included_tabs %}
        {% if tab == 'welcome' %}
          <button class="tab-button {% if first_tab == tab %}active{% endif %}" data-tab="welcome" data-index="{{ loop.index0 }}">Welcome</button>
        {% elif tab == 'checkin' %}
          <button class="tab-button {% if first_tab == tab %}active{% endif %}" data-tab="checkin" data-index="{{ loop.index0 }}">Check-in Info</button>
        {% elif tab == 'property' %}
          <button class="tab-button {% if first_tab == tab %}active{% endif %}" data-tab="property" data-index="{{ loop.index0 }}">Property Details</button>
        {% elif tab == 'food' %}
          <button class="tab-button {% if first_tab == tab %}active{% endif %}" data-tab="food" data-index="{{ loop.index0 }}">Food</button>
        {% elif tab == 'activities' %}
          <button class="tab-button {% if first_tab == tab %}active{% endif %}" data-tab="activities" data-index="{{ loop.index0 }}">Activities</button>
        {% elif tab == 'rules' %}
          <button class="tab-button {% if first_tab == tab %}active{% endif %}" data-tab="rules" data-index="{{ loop.index0 }}">Rules</button>
        {% elif tab == 'checkout' %}
          <button class="tab-button {% if first_tab == tab %}active{% endif %}" data-tab="checkout" data-index="{{ loop.index0 }}">Checkout Info</button>
        {% elif tab.startswith('custom_') %}
          {% set meta = (ctx.custom_tabs_meta.get(tab) if ctx.custom_tabs_meta else None) %}
          <button class="tab-button {% if first_tab == tab %}active{% endif %}" data-tab="{{ tab }}" data-index="{{ loop.index0 }}">
            {% if meta and meta.icon %}<span>{{ meta.icon }}</span>{% endif %}
            <span>{{ (meta.label if meta and meta.label) or (tab | replace('custom_', '') | replace('_', ' ') | title) }}</span>
          </button>
        {% endif %}
      {% endfor %}
    </div>
    <div class="tab-slider"></div>
  </div>

  <main class="content-container">
    {% if 'welcome' in ctx.included_tabs %}
    <div id="welcome" class="tab-content {% if first_tab == 'welcome' %}active{% endif %}">
      {% if ctx.welcome_message or ctx.address.street or ctx.address.city_state or ctx.address.zip %}
      <div class="card">
        <h2>Welcome</h2>
        {% if ctx.welcome_message %}
        <div class="info-item">
          <div class="whitespace-pre-line">{{ ctx.welcome_message }}</div>
        </div>
        {% endif %}
        {% if ctx.address.street or ctx.address.city_state or ctx.address.zip %}
        <div class="info-item"><strong>Location:</strong>
          <div>{{ ctx.address.street }}{% if ctx.address.city_state %}, {{ ctx.address.city_state }}{% endif %}{% if ctx.address.zip %}, {{ ctx.address.zip }}{% endif %}</div>
        </div>
        {% endif %}
      </div>
      {% endif %}
      {% if ctx.host and (ctx.host.name or ctx.host.contact or ctx.host.bio or ctx.host.photo_url) %}
      <div class="card">
        <h2>Host Info</h2>
        <div class="info-grid">
          {% if ctx.host.name %}<div class="info-item"><strong>Name:</strong> {{ ctx.host.name }}</div>{% endif %}
          {% if ctx.host.contact %}<div class="info-item"><strong>Contact:</strong> {{ ctx.host.contact }}</div>{% endif %}
          {% if ctx.host.bio %}
          <div class="info-item"><strong>Bio:</strong>
            <div class="whitespace-pre-line">{{ ctx.host.bio }}</div>
          </div>
          {% endif %}
          {% if ctx.host.photo_url %}
          <div class="info-item"><strong>Photo:</strong>
            <div><img src="{{ ctx.host.photo_url }}" alt="Host" style="width:96px;height:96px;object-fit:cover;border-radius:9999px;border:1px solid #e2e8f0;"/></div>
          </div>
          {% endif %}
        </div>
      </div>
      {% endif %}
      {% set si = ctx.safety_info or {} %}
      {% if si.emergency_contact or si.fire_extinguisher_location %}
      <div class="card">
        <h2>Safety Info</h2>
        <div class="info-grid">
          {% if si.emergency_contact %}
          <div class="info-item"><strong>Emergency Contact:</strong> {{ si.emergency_contact }}</div>
          {% endif %}
          {% if si.fire_extinguisher_location %}
          <div class="info-item"><strong>Fire Extinguisher Location:</strong> {{ si.fire_extinguisher_location }}</div>
          {% endif %}
        </div>
      </div>
      {% endif %}
    </div>
    {% endif %}
    {% if 'checkin' in ctx.included_tabs %}
    <div id="checkin" class="tab-content {% if first_tab == 'checkin' %}active{% endif %}">
      {% if ctx.welcome_message or ctx.address.street or ctx.address.city_state or ctx.address.zip or ctx.access_info or ctx.parking_info %}
      <div class="card">
        <h2>Check-in Info</h2>
        {% if ctx.welcome_message %}
        <div class="info-item"><strong>Welcome Message:</strong>
          <div>{{ ctx.welcome_message }}</div>
        </div>
        {% endif %}
        <div class="info-grid">
          {% if ctx.address.street or ctx.address.city_state or ctx.address.zip %}
          <div class="info-item"><strong>Location:</strong>
            <div>{{ ctx.address.street }}{% if ctx.address.city_state %}, {{ ctx.address.city_state }}{% endif %}{% if ctx.address.zip %}, {{ ctx.address.zip }}{% endif %}</div>
          </div>
          {% endif %}
          {% if ctx.access_info %}
          <div class="info-item"><strong>Access Info:</strong>
            <div class="whitespace-pre-line">{{ ctx.access_info }}</div>
          </div>
          {% endif %}
          {% if ctx.parking_info %}
          <div class="info-item"><strong>Parking Info:</strong>
            <div class="whitespace-pre-line">{{ ctx.parking_info }}</div>
          </div>
          {% endif %}
        </div>
      </div>
      {% endif %}
      {% if ctx.check_in_time or (ctx.wifi.network or ctx.wifi.password) %}
      <div class="card">
        <h2>Arrival</h2>
        <div class="info-grid">
          {% if ctx.check_in_time %}
          <div class="info-item"><strong>Check-in Time:</strong> {{ ctx.check_in_time }}</div>
          {% endif %}
          {% if ctx.wifi.network or ctx.wifi.password %}
          <div class="info-item"><strong>Wi‑Fi:</strong>
            <div>
              {% if ctx.wifi.network %}<div>Network: {{ ctx.wifi.network }}</div>{% endif %}
              {% if ctx.wifi.password %}<div>Password: {{ ctx.wifi.password }}</div>{% endif %}
            </div>
          </div>
          {% endif %}
        </div>
      </div>
      {% endif %}
    </div>
    {% endif %}

    {% if ctx.custom_sections %}
    {% for key, blocks in ctx.custom_sections.items() %}
      {% if key in ctx.included_tabs %}
      <div id="{{ key }}" class="tab-content {% if first_tab == key %}active{% endif %}">
        {% if blocks and blocks|length > 0 %}
        <div class="card">
          {% set meta = (ctx.custom_tabs_meta.get(key) if ctx.custom_tabs_meta else None) %}
          <h2>{{ (meta.label if meta and meta.label) or (key | replace('custom_', '') | replace('_', ' ') | title) }}</h2>
          <div class="info-grid">
            {% for text in blocks %}
              {% if text %}
              <div class="info-item">
                <div class="whitespace-pre-line">{{ text }}</div>
              </div>
              {% endif %}
            {% endfor %}
          </div>
        </div>
        {% endif %}
      </div>
      {% endif %}
    {% endfor %}
    {% endif %}

    {% if 'property' in ctx.included_tabs %}
    <div id="property" class="tab-content {% if first_tab == 'property' %}active{% endif %}">
      {% if ctx.property_name %}
      <div class="card">
        <h2>Property Details</h2>
        <div class="info-item"><strong>Property Name:</strong> {{ ctx.property_name }}</div>
      </div>
      {% endif %}
      {% if ctx.house_manual and ctx.house_manual|length > 0 %}
      <div class="card">
        <h2>House Manual</h2>
        <div class="info-grid">
          {% for item in ctx.house_manual %}
          <div class="info-item">
            {% if item.name %}<strong>{{ item.name }}</strong>{% endif %}
            {% if item.description %}<div class="whitespace-pre-line">{{ item.description }}</div>{% endif %}
          </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}
    </div>
    {% endif %}

    {% if 'food' in ctx.included_tabs %}
    <div id="food" class="tab-content {% if first_tab == 'food' %}active{% endif %}">
      {% if ctx.places_to_eat and ctx.places_to_eat|length > 0 %}
      <div class="card">
        <h2>Nearby Food</h2>
        <div class="recommendation-grid">
          {% for place in ctx.places_to_eat %}
          <div class="recommendation-card">
            {% if place.image_url %}<img src="{{ place.image_url }}" alt="{{ place.name }}">{% endif %}
            <div class="recommendation-card-content">
              {% if place.name %}<h3>{{ place.name }}</h3>{% endif %}
              {% if place.description %}<p>{{ place.description }}</p>{% endif %}
              {% if place.address %}<p style="color: #64748b; font-size: 0.9rem; margin-top: 0.25rem;">{{ place.address }}</p>{% endif %}
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}
    </div>
    {% endif %}

    {% if 'activities' in ctx.included_tabs %}
    <div id="activities" class="tab-content {% if first_tab == 'activities' %}active{% endif %}">
      {% if ctx.things_to_do and ctx.things_to_do|length > 0 %}
      <div class="card">
        <h2>Nearby Activities</h2>
        <div class="recommendation-grid">
          {% for place in ctx.things_to_do %}
          <div class="recommendation-card">
            {% if place.image_url %}<img src="{{ place.image_url }}" alt="{{ place.name }}">{% endif %}
            <div class="recommendation-card-content">
              {% if place.name %}<h3>{{ place.name }}</h3>{% endif %}
              {% if place.description %}<p>{{ place.description }}</p>{% endif %}
              {% if place.address %}<p style="color: #64748b; font-size: 0.9rem; margin-top: 0.25rem;">{{ place.address }}</p>{% endif %}
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
      {% endif %}
    </div>
    {% endif %}

    {% if 'rules' in ctx.included_tabs %}
    <div id="rules" class="tab-content {% if first_tab == 'rules' %}active{% endif %}">
      {% if ctx.rules and ctx.rules|length > 0 %}
      <div class="card">
        <h2>Rules</h2>
        <ul class="rules-list">
          {% for rule in ctx.rules %}
            {% if rule %}<li>{{ rule }}</li>{% endif %}
          {% endfor %}
        </ul>
      </div>
      {% endif %}
    </div>
    {% endif %}

    {% if 'checkout' in ctx.included_tabs %}
    <div id="checkout" class="tab-content {% if first_tab == 'checkout' %}active{% endif %}">
      {% if ctx.check_out_time or (ctx.checkout_info and ctx.checkout_info|length > 0) %}
      <div class="card">
        <h2>Checkout Info</h2>
        {% if ctx.check_out_time %}<div class="info-item"><strong>Checkout Time:</strong> {{ ctx.check_out_time }}</div>{% endif %}
        {% if ctx.checkout_info and ctx.checkout_info|length > 0 %}
        <ul class="rules-list">
          {% for info in ctx.checkout_info %}
            <li><strong>{{ info.name }}</strong>{% if info.description %}: {{ info.description }}{% endif %}</li>
          {% endfor %}
        </ul>
        {% endif %}
      </div>
      {% endif %}
    </div>
    {% endif %}
  </main>

  <script>
    (function(){
      const tabs = Array.from(document.querySelectorAll('.tab-button'));
      const slider = document.querySelector('.tab-slider');
      const sections = Array.from(document.querySelectorAll('.tab-content'));
      function positionSlider(active){
        if (!active) return;
        const rect = active.getBoundingClientRect();
        const parentRect = active.parentElement.getBoundingClientRect();
        slider.style.left = (active.offsetLeft - 8) + 'px';
        slider.style.width = (rect.width + 16) + 'px';
      }
      function showTab(tabId){
        tabs.forEach(t => t.classList.toggle('active', t.getAttribute('data-tab') === tabId));
        sections.forEach(s => s.classList.toggle('active', s.id === tabId));
        const active = tabs.find(t => t.getAttribute('data-tab') === tabId);
        positionSlider(active);
      }
      tabs.forEach(t => t.addEventListener('click', () => showTab(t.getAttribute('data-tab'))));
      positionSlider(document.querySelector('.tab-button.active'));
    })();
  </script>
</body>
</html>
